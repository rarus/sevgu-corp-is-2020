
# Лабораторная работа №3 – OpenAPI 3.0

## Задание
1. Создать новый проект с `@redocly/openapi-cli`
2. Описать API предметной области по варианту в формате OpenAPI 3.0
3. Разместить спецификацию в отдельном репозитории Github
4. Опубликовать спецификацию на Github Pages используя ветку `gh-pages`

## Критерии
1. Все методы в спецификации соответствуют варианту
2. На Github Pages доступен и работоспособен интерфейс Redoc

## Подробное описание
The OpenAPI Specification — формализованная спецификация и экосистема множества инструментов, предоставляющая интерфейс между front-end системами, кодом библиотек низкого уровня и коммерческими решениями в виде API. Вместе с тем, спецификация построена таким образом, что не зависит от языков программирования, и удобна в использовании как человеком, так и машиной.

На этом с Википедией хватит.

Что бы создать проект вам нужен установленный yarn (если очень нравится npm без проблем, но команды будут для yarn), соответственно NodeJS (пожалуйста, используйте актуальные версии) и git. Тут и далее рассматриваются исключительно консольные команды, управляющих интерфейсов нет.

1. В папке проекта инициализируем git репозиторий

`git init`

2. Инициализируем nodejs проект с помощью yarn

`yarn init` – На все вопросы можете просто нажать enter

3. Добавим необходимые зависимости в проект

`yarn add @redocly/openapi-cli`

4. Укажем короткие команды для дальнейшей работы

В файле package.json добавим секцию
```
"scripts": {
	"start": "openapi preview-docs",
	"build": "openapi bundle -o dist",
	"test": "openapi validate"
}
```

5. В корне проекта создадим файл .redocly.yaml для настройки Redoc

Минимальное содержимое, можете дополнить стилями по желанию
```yaml 
apiDefinitions:
  main: openapi/openapi.yaml
lint:
  rules:
    no-unused-schemas: warning
referenceDocs:
  showConsole: true
  layout:
    scope: section
  htmlTemplate: ./web/index.html
```

6. Создадим файл шаблона в папке web

```html
<!DOCTYPE html>
<html>
  <head>
    <title>REST API Specification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="prefetch" href="./openapi.json">
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Verdana, Geneva, sans-serif;
        font-size: 14px;
        color: #333;
      }
    </style>
    {{redocHead}}
  </head>
  <body>
    {{redocBody}}
  </body>
</html>
```

7. Создадим основной файл спецификации openapi/openapi.yaml

```yaml
openapi: 3.0.0
info:
  version: '1.0'
  title: REST API
  contact:
    name: Ваше имя
    email: и почта
servers:
  - url: 'https://example.com/v1.0'
    description: Live Server
tags:
  - name: Раздел
    description: |
      Описание раздела
      в несколько
      строк
security:
  - SecretApiKey: []
  - JWT: []
paths:
  /foo:
    $ref: ./paths/foo.yaml
```
В блоке `paths` определяются все доступные методы вашего API.
Директива $ref позволяет разбить спецификацию на отдельные файлы, не загромождая корневой файл.
Она подставляет содержимое указанного файла на своё место.

Доступные методы следует декларировать в отдельных файлах внутри папки openapi/paths.

8. Описать API по варианту в заданном формате. Для примера используйте [Rebilly API](https://github.com/Rebilly/RebillyAPI/tree/master/openapi).

В процессе работы полезно проверять как выглядит ваш API, для этого воспользуйтесь командой `yarn serve` 

9. Создайте новый репозиторий на Github и залейте ваш код в него
10. В ветку gh-pages залейте собранную спецификацию

Для сборки используйте `yarn build` содержимое папки dist и является собранной спецификацией.э

11. В настройках репозитория GitHub активируйте Pages и укажите источником ветку `gh-pages`

## Варианты

Выбирается вариант по номеру в журнале.
Все варианты являются реальными сервисами API которых вам надо спроектировать (можно взять аналог сервиса). Помимо ключевых особенностей каждого необходим функционал входа/выхода и регистрации пользователей.
Не обязательно учитывать все мелкие детали, только основной функционал.
Если вы не согласовали вариант до перехода на дистанционную форму обучения – обращайтесь к преподавателю за вариантом в https://chat.is.sevsu.ru
|№ |Сервис-пример|
|--|-------------|
|1 |Avito        |
|2 |Telegram     |
|3 |Instagram    |
|4 |Youtube      |
|5 |Twitter      |
|6 |Яндекс Музыка|
|7 |Кинопоиск    |
|8 |РНКБ.Онлайн  |
|9 |Aviasales    |
|10|Ozon         |
|11|Рамблер Касса|
|12|Delivery Club|
|13|Booking      |
|14|Lostfilm     |
|15|ЛитРес       |
|16|Habr         |
|17|Pikabu       |
|18|Gmail        |
|19|HH.ru        |
|20|Steam        |

Вариант можно заменить на тему диплома или произвольный сервис с согласия преподавателя.

## Советы
Прежде чем строить спецификацию определите сущности и связи, выпишите их в удобной вам форме и только потом приступайте к спецификации.

При написании спецификации смотрите как всё устроено в примере, обязательно отслеживайте изменения с помощью `yarn serve`. 

Если сложно сразу писать в раздельных файлах *(сомневаюсь)* существуют OpenAPI онлайн редакторы, которые работают с одним файлом и сразу отображают изменения, например [Swagger Editor](https://editor.swagger.io/).

## Полезные ссылки
1. https://swagger.io/docs/specification/about/
2. https://github.com/Redocly/openapi-cli
3. https://github.com/Rebilly/RebillyAPI
4. https://github.com/Redocly/redoc
