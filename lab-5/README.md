
# Лабораторная работа №5 – Doctrine ORM

## Задание
1. Подключить к проекту из ЛР №4 пакет Doctrine
2. Создать сущности и репозитории в соответствии с ЛР №3
3. Реализовать методы контроллеров с использованием Doctrine ORM
4. Разместить проект в отдельной ветке или репозитории Github

## Критерии
1. В репозитории на github лежит проект на Symfony+Doctrine
2. Для всех методов из ЛР №3 существует реализованный метод

## Подробное описание
### 1. Подключить к проекту из ЛР №4 пакет Doctrine
```
composer require symfony/orm-pack
composer require --dev symfony/maker-bundle
```
В файл `.env` укажите параметры подключения к базе
```
DATABASE_URL="mysql://db_user:db_password@127.0.0.1:3306/db_name"
```

### 2. Создать сущности и репозитории в соответствии с ЛР №3
Для создания сущности воспользуйтесь командой
```
php bin/console make:entity
```
В интерактивном режиме укажите имя сущности, названия её полей и их типы.
Повторите для каждой сущности.

В результате в директории `src/Entity` будут созданы классы сущностей, а в `src/Repository` классы репозиториев для этих сущностей.

Реализуйте в репозиториях методы получения данных в соответствии с вашим API.

### 3. Реализовать методы контроллеров с использованием Doctrine ORM 
В контроллерах заместо заглушек реализуйте чтение, добавление, изменение и удаление данных в соответствии с API.

Для чтения данных воспользуйтесь репозиторием соответствующей сущности.
Чтобы получить объект репозитория вы можете воспользоваться *Dependency Injection* (укажите `EntityRepository $repository` как аргумент вашего метода) или явным получением с помощью 
```php
$repository = $this->getDoctrine()
				   ->getRepository(Entity::class)
```
Класс вашего контроллера при этом должен наследоваться от `Symfony\Bundle\FrameworkBundle\Controller\AbstractController`

Для добавления записи в базу создайте объект сущности, заполните его поля и добавьте его к записи в `EntityManager`:
```php
// Получениие EntityManager
$entityManager = $this->getDoctrine()->getManager();

$entityManager->persist($entity);
$entityManager->flush();
```
В этом примере метод `flush()` осуществляет фактическую запись в базу и без него ничего сохранено не будет. 

Для изменения записи в базе извлеките её через репозиторий, внесите изменения и запишите их в базу:
```php
$entityManager->flush();
```

Для удаления из базы извлеките её через репозиторий и вызовите соответствующе методы:
```php
$entityManager->remove($entity);
$entityManager->flush();
```

### 4. Разместить проект в отдельной ветке или репозитории Github
С этим вы справитесь и сами)

## Советы
В лекции №5 есть вся информация, необходимая для этой лабораторной работы

## Полезные ссылки
1. https://symfony.com/doc/current/doctrine.html
